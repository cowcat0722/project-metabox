{{> layout/header}}
<head>
    <link rel="stylesheet" href="/css/guestCheckForm.css">
</head>

<body>
<div class="container">
    <div class="form-container">
        <h2 style="color: #4E0929;">비회원 예매 확인</h2>
        <form id="reservation-form">
            <div class="form-group">
                <label for="name">성명</label>
                <input type="text" class="form-control" id="name" placeholder="성명" value="박찬혁" required>
            </div>
            <div class="form-group">
                <label for="birthdate">휴대전화번호</label>
                <input type="text" class="form-control" id="phone" placeholder="전화번호" value="010-2222-4443" required>
            </div>
            <div class="form-group">
                <label for="password">비밀번호</label>
                <input type="password" class="form-control" id="password" placeholder="비밀번호 (4자리)" value="1234"
                       required>
            </div>
            <br>
            <button type="submit" class="btn-custom" onclick="formSend()">비회원 예매확인</button>
        </form>
        <p class="form-text">
            * 비회원 정보 오 입력 시 예매 내역 확인/취소 및 티켓 발권이 <br> 어려울 수 있으니 다시 한번 확인해 주시기 바랍니다.
        </p>
    </div>
</div>

<!-- Modal -->
<div class="modal fade" id="reservationModal" tabindex="-1" aria-labelledby="reservationModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="reservationModalLabel">예매 정보 확인</h5>
                <button type="button" class="close" aria-label="Close">
                    <span aria-hidden="true" style="color: white">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="value">
                    <p class="label mt-3">[ 예매자 ]</p>
                    <p id="modal-name"></p>
                </div>
                <div class="value">
                    <p class="label">[ 영화 ]</p>
                    <p id="modal-movie"></p>
                </div>
                <div class="value">
                    <p class="label">[ 극장 ]</p>
                    <p id="modal-theater"></p>
                </div>
                <div class="value">
                    <p class="label">[ 일시 ]</p>
                    <p id="modal-datetime"></p>
                </div>
                <div class="value">
                    <p class="label">[ 상영관 ]</p>
                    <p id="modal-hall"></p>
                </div>
                <div class="value">
                    <p class="label">[ 좌석명 ]</p>
                    <p id="modal-seatname"></p>
                </div>
                <div class="value">
                    <p class="label">[ 좌석번호 ]</p>
                    <p id="modal-seat"></p>
                </div>
                <div class="value">
                    <p class="label">[ 인원 ]</p>
                    <p id="modal-persons"></p>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="modal-close-btn">닫기</button>
            </div>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>

<script>
    // 모달창 닫기
    $('#modal-close-btn').on('click', function () {
        $('#reservationModal').modal('hide');
    });

    $('.close').on('click', function () {
        $('#reservationModal').modal('hide');
    });

    // 휴대전화 010-3333-3333 형식
    function formatPhoneNumber(value) {
        value = value.replace(/\D/g, '');
        if (value.length > 3 && value.length <= 7) {
            value = value.replace(/(\d{3})(\d+)/, '$1-$2');
        } else if (value.length > 7) {
            value = value.replace(/(\d{3})(\d{4})(\d+)/, '$1-$2-$3');
        }
        return value;
    }

    $('#phone').on('input', function () {
        let formattedValue = formatPhoneNumber($(this).val());
        $(this).val(formattedValue);
    });

    // 비밀번호 4자리 제한
    $('#password').on('input', function () {
        let value = $(this).val();
        value = value.replace(/\D/g, '');
        if (value.length > 4) {
            value = value.slice(0, 4);
        }
        $(this).val(value);
    });

    $('#reservation-form').on('submit', function (e) {
        e.preventDefault(); // 폼의 기본 제출 방지

        let name = $('#name').val();
        let phone = $('#phone').val();
        let password = $('#password').val();

        let sendCheckForm = {
            name: name,
            phone: phone,
            password: password
        };

        console.log("전송 데이터: ", sendCheckForm);

        // 모달창에 값 표시
        let theater = 'METABOX 광주';  // 임의로 설정된 값
        let datetime = '2024-06-15 19:00';  // 임의로 설정된 값
        let hall = '1관';  // 임의로 설정된 값
        let movie = '인사이드 아웃 2';  // 임의로 설정된 값
        let seatname = '일반석';  // 임의로 설정된 값
        let seat = 'A10, A11';  // 임의로 설정된 값
        let persons = '2명';  // 임의로 설정된 값

        $('#modal-name').text(name);
        $('#modal-theater').text(theater);
        $('#modal-datetime').text(datetime);
        $('#modal-hall').text(hall);
        $('#modal-movie').text(movie);
        $('#modal-seatname').text(seatname);
        $('#modal-seat').text(seat);
        $('#modal-persons').text(persons);

        $('#reservationModal').modal('show');

        $.ajax({
            url: '/guest/book-check',
            data: JSON.stringify(sendCheckForm),
            contentType: 'application/json; charset=utf-8',
            type: 'POST'
        }).done((res) => {
            console.log("서버 응답: ", res);
            alert("예매 확인이 성공적으로 완료되었습니다.");
        }).fail((res) => {
            console.error("에러 응답: ", res);
            alert("예매 확인 중 오류가 발생했습니다.");
        });
    });
</script>

{{> layout/footer}}
